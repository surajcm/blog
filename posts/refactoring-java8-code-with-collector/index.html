<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Refactoring java8 code with collector | Explore my world</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Hello world to the blogging universe."><meta name=generator content="Hugo 0.119.0"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/blog/ananke/css/main.min.css><meta property="og:title" content="Refactoring java8 code with collector"><meta property="og:description" content="Hello world to the blogging universe."><meta property="og:type" content="article"><meta property="og:url" content="https://surajcm.github.io/blog/posts/refactoring-java8-code-with-collector/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-18T00:00:00+00:00"><meta property="article:modified_time" content="2022-01-18T00:00:00+00:00"><meta itemprop=name content="Refactoring java8 code with collector"><meta itemprop=description content="Hello world to the blogging universe."><meta itemprop=datePublished content="2022-01-18T00:00:00+00:00"><meta itemprop=dateModified content="2022-01-18T00:00:00+00:00"><meta itemprop=wordCount content="1770"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Refactoring java8 code with collector"><meta name=twitter:description content="Hello world to the blogging universe."></head><body class="ma0 avenir bg-near-white"><header class="cover bg-top" style=background-image:url(https://surajcm.github.io/blog/img/2022/01/programming.png)><div class=bg-black-60><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/blog/ class="f3 fw2 hover-white no-underline white-90 dib">Explore my world</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href title="Home page">Home</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=https://surajcm.github.io/#about title="About page">About</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=https://surajcm.github.io/blog title="Blog page">Blog</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=categories title="Categories page">Categories</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=https://surajcm.github.io/#contact title="Contact page">Contact</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/blog/authors/ title="Authors page">Authors</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/blog/posts/ title="Posts page">Posts</a></li></ul><div class=ananke-socials></div></div></div></nav><div class="tc-l pv6 ph3 ph4-ns"><div class="f2 f1-l fw2 white-90 mb0 lh-title">Refactoring java8 code with collector</div><div class="fw1 f5 f3-l white-80 measure-wide-l center lh-copy mt3 mb4">Hello world to the blogging universe.</div></div></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POSTS</aside><div id=sharing class="mt3 ananke-socials"></div><h1 class="f1 athelas mt3 mb1">Refactoring java8 code with collector</h1><time class="f6 mv4 dib tracked" datetime=2022-01-18T00:00:00Z>January 18, 2022</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>I am planning to refactor a code that is based on Java 7 to Java 8 using the functional components, specifically Collector. The plan is simple: learn it by coding it. Let’s get started…</p><h2 id=overview-of-the-java-object-we-are-dealing-with>Overview of the Java Object We Are Dealing With</h2><p><img src=/blog/img/2022/01/java8-fun.png alt></p><p>The following code is intend to fetch a few specific data from Company object, where company has a list of employees. I would like to perform the following operations,</p><pre><code>Find out the most common name (Employee name) in the company
Find the highest salaried employee of the company
Find the sum of salaries for all Men
Find most popular grade/band in the company
</code></pre><p>Prior to java 8, it is tough to refactor these logic and find out some common parts. But the functional components make the refactoring easy.</p><hr><h2 id=pre-java8-version>Pre-Java8 version:</h2><p>Let’s go through the code,</p><h3 id=find-out-the-most-common-employee-name-in-the-company>Find out the most common employee name in the company</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>findMostRepeatingNameInCompany</span><span style=color:#f92672>(</span>Company company<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    String repeatingName <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> Integer<span style=color:#f92672>&gt;</span> nameAndCount <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>Department department <span style=color:#f92672>:</span> company<span style=color:#f92672>.</span><span style=color:#a6e22e>getDepartments</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>Employee employee <span style=color:#f92672>:</span> department<span style=color:#f92672>.</span><span style=color:#a6e22e>getEmployees</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>nameAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>containsKey</span><span style=color:#f92672>(</span>employee<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>()))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                nameAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>employee<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>(),</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                Integer count <span style=color:#f92672>=</span> nameAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>employee<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>                count<span style=color:#f92672>++;</span>
</span></span><span style=display:flex><span>                nameAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>employee<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>(),</span> count<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>Map<span style=color:#f92672>.</span><span style=color:#a6e22e>Entry</span><span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> Integer<span style=color:#f92672>&gt;</span> entry <span style=color:#f92672>:</span> nameAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>entrySet</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>entry<span style=color:#f92672>.</span><span style=color:#a6e22e>getValue</span><span style=color:#f92672>().</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>Collections<span style=color:#f92672>.</span><span style=color:#a6e22e>max</span><span style=color:#f92672>(</span>nameAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>values</span><span style=color:#f92672>())))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            repeatingName <span style=color:#f92672>=</span> entry<span style=color:#f92672>.</span><span style=color:#a6e22e>getKey</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> repeatingName<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=find-the-highest-salaried-employee>Find the highest salaried employee</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> Employee <span style=color:#a6e22e>findEmployeeWithHighestSalaryInTheCompany</span><span style=color:#f92672>(</span>Company company<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    Employee costlyEmployee <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    Map<span style=color:#f92672>&lt;</span>Employee<span style=color:#f92672>,</span> Long<span style=color:#f92672>&gt;</span> employeeAndSalary <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>Department department <span style=color:#f92672>:</span> company<span style=color:#f92672>.</span><span style=color:#a6e22e>getDepartments</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>Employee employee <span style=color:#f92672>:</span> department<span style=color:#f92672>.</span><span style=color:#a6e22e>getEmployees</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            employeeAndSalary<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>employee<span style=color:#f92672>,</span> employee<span style=color:#f92672>.</span><span style=color:#a6e22e>getSalary</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>Map<span style=color:#f92672>.</span><span style=color:#a6e22e>Entry</span><span style=color:#f92672>&lt;</span>Employee<span style=color:#f92672>,</span> Long<span style=color:#f92672>&gt;</span> entry <span style=color:#f92672>:</span> employeeAndSalary<span style=color:#f92672>.</span><span style=color:#a6e22e>entrySet</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>entry<span style=color:#f92672>.</span><span style=color:#a6e22e>getValue</span><span style=color:#f92672>().</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>Collections<span style=color:#f92672>.</span><span style=color:#a6e22e>max</span><span style=color:#f92672>(</span>employeeAndSalary<span style=color:#f92672>.</span><span style=color:#a6e22e>values</span><span style=color:#f92672>())))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            costlyEmployee <span style=color:#f92672>=</span> entry<span style=color:#f92672>.</span><span style=color:#a6e22e>getKey</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> costlyEmployee<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=find-the-sum-of-salaries-for-all-men>Find the sum of salaries for all Men</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> Long <span style=color:#a6e22e>findSumOfAllMenSalary</span><span style=color:#f92672>(</span>Company company<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    Long totalSalary <span style=color:#f92672>=</span> <span style=color:#ae81ff>0L</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>Department department <span style=color:#f92672>:</span> company<span style=color:#f92672>.</span><span style=color:#a6e22e>getDepartments</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>Employee employee <span style=color:#f92672>:</span> department<span style=color:#f92672>.</span><span style=color:#a6e22e>getEmployees</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>employee<span style=color:#f92672>.</span><span style=color:#a6e22e>getGender</span><span style=color:#f92672>().</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>Gender<span style=color:#f92672>.</span><span style=color:#a6e22e>MALE</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                totalSalary <span style=color:#f92672>=</span> totalSalary <span style=color:#f92672>+</span> employee<span style=color:#f92672>.</span><span style=color:#a6e22e>getSalary</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> totalSalary<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=find-most-popular-gradeband-in-the-company>Find most popular grade/band in the company</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> Band <span style=color:#a6e22e>findMostPopularBandInCompany</span><span style=color:#f92672>(</span>Company company<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    Band popularBand <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    Map<span style=color:#f92672>&lt;</span>Band<span style=color:#f92672>,</span> Integer<span style=color:#f92672>&gt;</span> bandAndCount <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>Department department <span style=color:#f92672>:</span> company<span style=color:#f92672>.</span><span style=color:#a6e22e>getDepartments</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>Employee employee <span style=color:#f92672>:</span> department<span style=color:#f92672>.</span><span style=color:#a6e22e>getEmployees</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>bandAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>containsKey</span><span style=color:#f92672>(</span>employee<span style=color:#f92672>.</span><span style=color:#a6e22e>getBand</span><span style=color:#f92672>()))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                bandAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>employee<span style=color:#f92672>.</span><span style=color:#a6e22e>getBand</span><span style=color:#f92672>(),</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                Integer count <span style=color:#f92672>=</span> bandAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>employee<span style=color:#f92672>.</span><span style=color:#a6e22e>getBand</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>                count<span style=color:#f92672>++;</span>
</span></span><span style=display:flex><span>                bandAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>employee<span style=color:#f92672>.</span><span style=color:#a6e22e>getBand</span><span style=color:#f92672>(),</span> count<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>Map<span style=color:#f92672>.</span><span style=color:#a6e22e>Entry</span><span style=color:#f92672>&lt;</span>Band<span style=color:#f92672>,</span> Integer<span style=color:#f92672>&gt;</span> entry <span style=color:#f92672>:</span> bandAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>entrySet</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>entry<span style=color:#f92672>.</span><span style=color:#a6e22e>getValue</span><span style=color:#f92672>().</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>Collections<span style=color:#f92672>.</span><span style=color:#a6e22e>max</span><span style=color:#f92672>(</span>bandAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>values</span><span style=color:#f92672>())))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            popularBand <span style=color:#f92672>=</span> entry<span style=color:#f92672>.</span><span style=color:#a6e22e>getKey</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> popularBand<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>In all the cases, we need to iterate through various departments and then employees in it. But since the conditions and the data we want to collect are in a different format, we wont be able to find something common and refactor it properly. Let’s see how java8 deals with this.</p><hr><p>As an initial step, lets use streams and do the processing.</p><h3 id=find-out-the-most-common-employee-name-in-the-company-1>Find out the most common employee name in the company</h3><p>Let’s go through the logic of nameAndCount, since the iterations (for loop on department and employee) have a defined result(nameAndCount), we can use streams to get that value</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>company<span style=color:#f92672>.</span><span style=color:#a6e22e>getDepartments</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>().</span><span style=color:#a6e22e>flatMap</span><span style=color:#f92672>(</span>department <span style=color:#f92672>-&gt;</span> department<span style=color:#f92672>.</span><span style=color:#a6e22e>getEmployees</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>())</span>
</span></span><span style=display:flex><span> <span style=color:#f92672>.</span><span style=color:#a6e22e>forEach</span><span style=color:#f92672>(</span>employee <span style=color:#f92672>-&gt;</span> addToNameAndCountMap<span style=color:#f92672>(</span>nameAndCount<span style=color:#f92672>,</span> employee<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addToNameAndCountMap</span><span style=color:#f92672>(</span>Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> Integer<span style=color:#f92672>&gt;</span> nameAndCount<span style=color:#f92672>,</span> Employee employee<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>nameAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>containsKey</span><span style=color:#f92672>(</span>employee<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>()))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        nameAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>employee<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>(),</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Integer count <span style=color:#f92672>=</span> nameAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>employee<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        count<span style=color:#f92672>++;</span>
</span></span><span style=display:flex><span>        nameAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>employee<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>(),</span> count<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>why didn’t we get the result via collect? We have some logic there, we need to identify the duplicates, the value of the map is count of employee names. Let’s see the final results.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>findMostRepeatingNameInCompany</span><span style=color:#f92672>(</span>Company company<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> Integer<span style=color:#f92672>&gt;</span> nameAndCount <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>    company<span style=color:#f92672>.</span><span style=color:#a6e22e>getDepartments</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>flatMap</span><span style=color:#f92672>(</span>department <span style=color:#f92672>-&gt;</span> department<span style=color:#f92672>.</span><span style=color:#a6e22e>getEmployees</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>())</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>forEach</span><span style=color:#f92672>(</span>employee <span style=color:#f92672>-&gt;</span> addToNameAndCountMap<span style=color:#f92672>(</span>nameAndCount<span style=color:#f92672>,</span> employee<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    String repeatingName <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    Integer maxCount <span style=color:#f92672>=</span> Collections<span style=color:#f92672>.</span><span style=color:#a6e22e>max</span><span style=color:#f92672>(</span>nameAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>values</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    Optional<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> repeat <span style=color:#f92672>=</span> nameAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>entrySet</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>filter</span><span style=color:#f92672>(</span>e <span style=color:#f92672>-&gt;</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getValue</span><span style=color:#f92672>().</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>maxCount<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>map</span><span style=color:#f92672>(</span>Map<span style=color:#f92672>.</span><span style=color:#a6e22e>Entry</span><span style=color:#f92672>::</span>getKey<span style=color:#f92672>).</span><span style=color:#a6e22e>findFirst</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>repeat<span style=color:#f92672>.</span><span style=color:#a6e22e>isPresent</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        repeatingName <span style=color:#f92672>=</span> repeat<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> repeatingName<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addToNameAndCountMap</span><span style=color:#f92672>(</span>Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> Integer<span style=color:#f92672>&gt;</span> nameAndCount<span style=color:#f92672>,</span> Employee employee<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>nameAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>containsKey</span><span style=color:#f92672>(</span>employee<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>()))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        nameAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>employee<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>(),</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Integer count <span style=color:#f92672>=</span> nameAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>employee<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        count<span style=color:#f92672>++;</span>
</span></span><span style=display:flex><span>        nameAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>employee<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>(),</span> count<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=find-the-highest-salaried-employee-1>Find the highest salaried employee</h3><p>Let’s do the same refactoring here as well. But here, we can use collect as the logic is fairly less complex.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> Employee <span style=color:#a6e22e>findEmployeeWithHighestSalaryInTheCompany</span><span style=color:#f92672>(</span>Company company<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    Employee costlyEmployee <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    Map<span style=color:#f92672>&lt;</span>Employee<span style=color:#f92672>,</span> Long<span style=color:#f92672>&gt;</span> employeeAndSalary <span style=color:#f92672>=</span> company<span style=color:#f92672>.</span><span style=color:#a6e22e>getDepartments</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>flatMap</span><span style=color:#f92672>(</span>department <span style=color:#f92672>-&gt;</span> department<span style=color:#f92672>.</span><span style=color:#a6e22e>getEmployees</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>())</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>collect</span><span style=color:#f92672>(</span>Collectors<span style=color:#f92672>.</span><span style=color:#a6e22e>toMap</span><span style=color:#f92672>(</span>employee <span style=color:#f92672>-&gt;</span> employee<span style=color:#f92672>,</span> Employee<span style=color:#f92672>::</span>getSalary<span style=color:#f92672>,</span> <span style=color:#f92672>(</span>a<span style=color:#f92672>,</span> b<span style=color:#f92672>)</span> <span style=color:#f92672>-&gt;</span> b<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    Long maxSalary <span style=color:#f92672>=</span> Collections<span style=color:#f92672>.</span><span style=color:#a6e22e>max</span><span style=color:#f92672>(</span>employeeAndSalary<span style=color:#f92672>.</span><span style=color:#a6e22e>values</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    Optional<span style=color:#f92672>&lt;</span>Employee<span style=color:#f92672>&gt;</span> costly <span style=color:#f92672>=</span> employeeAndSalary<span style=color:#f92672>.</span><span style=color:#a6e22e>entrySet</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>filter</span><span style=color:#f92672>(</span>e <span style=color:#f92672>-&gt;</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getValue</span><span style=color:#f92672>().</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>maxSalary<span style=color:#f92672>)).</span><span style=color:#a6e22e>map</span><span style=color:#f92672>(</span>Map<span style=color:#f92672>.</span><span style=color:#a6e22e>Entry</span><span style=color:#f92672>::</span>getKey<span style=color:#f92672>).</span><span style=color:#a6e22e>findFirst</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>costly<span style=color:#f92672>.</span><span style=color:#a6e22e>isPresent</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        costlyEmployee <span style=color:#f92672>=</span> costly<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> costlyEmployee<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=find-the-sum-of-salaries-for-all-men-1>Find the sum of salaries for all Men</h3><p>Well, this one seems much simpler.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> Long <span style=color:#a6e22e>findSumOfAllMenSalary</span><span style=color:#f92672>(</span>Company company<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> company<span style=color:#f92672>.</span><span style=color:#a6e22e>getDepartments</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>flatMap</span><span style=color:#f92672>(</span>d <span style=color:#f92672>-&gt;</span> d<span style=color:#f92672>.</span><span style=color:#a6e22e>getEmployees</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>())</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>filter</span><span style=color:#f92672>(</span>e <span style=color:#f92672>-&gt;</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getGender</span><span style=color:#f92672>().</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>Gender<span style=color:#f92672>.</span><span style=color:#a6e22e>MALE</span><span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>map</span><span style=color:#f92672>(</span>Employee<span style=color:#f92672>::</span>getSalary<span style=color:#f92672>).</span><span style=color:#a6e22e>mapToLong</span><span style=color:#f92672>(</span>Long<span style=color:#f92672>::</span>longValue<span style=color:#f92672>).</span><span style=color:#a6e22e>sum</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=find-most-popular-gradeband-in-the-company-1>Find most popular grade/band in the company</h3><p>We need to apply the similar logic as we did for the first method (I mean findMostRepeatingNameInCompany). Let’s try it</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> Band <span style=color:#a6e22e>findMostPopularBandInCompany</span><span style=color:#f92672>(</span>Company company<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    Map<span style=color:#f92672>&lt;</span>Band<span style=color:#f92672>,</span> Integer<span style=color:#f92672>&gt;</span> bandAndCount <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>    company<span style=color:#f92672>.</span><span style=color:#a6e22e>getDepartments</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>flatMap</span><span style=color:#f92672>(</span>department <span style=color:#f92672>-&gt;</span> department<span style=color:#f92672>.</span><span style=color:#a6e22e>getEmployees</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>())</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>forEach</span><span style=color:#f92672>(</span>employee <span style=color:#f92672>-&gt;</span> addToBandAndCoutMap<span style=color:#f92672>(</span>bandAndCount<span style=color:#f92672>,</span> employee<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    Band popularBand <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    Integer maxBand <span style=color:#f92672>=</span> Collections<span style=color:#f92672>.</span><span style=color:#a6e22e>max</span><span style=color:#f92672>(</span>bandAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>values</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    Optional<span style=color:#f92672>&lt;</span>Band<span style=color:#f92672>&gt;</span> popular <span style=color:#f92672>=</span> bandAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>entrySet</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>filter</span><span style=color:#f92672>(</span>e <span style=color:#f92672>-&gt;</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getValue</span><span style=color:#f92672>().</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>maxBand<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>map</span><span style=color:#f92672>(</span>Map<span style=color:#f92672>.</span><span style=color:#a6e22e>Entry</span><span style=color:#f92672>::</span>getKey<span style=color:#f92672>).</span><span style=color:#a6e22e>findFirst</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>popular<span style=color:#f92672>.</span><span style=color:#a6e22e>isPresent</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        popularBand <span style=color:#f92672>=</span> popular<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> popularBand<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addToBandAndCoutMap</span><span style=color:#f92672>(</span>Map<span style=color:#f92672>&lt;</span>Band<span style=color:#f92672>,</span> Integer<span style=color:#f92672>&gt;</span> bandAndCount<span style=color:#f92672>,</span> Employee employee<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>bandAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>containsKey</span><span style=color:#f92672>(</span>employee<span style=color:#f92672>.</span><span style=color:#a6e22e>getBand</span><span style=color:#f92672>()))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        bandAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>employee<span style=color:#f92672>.</span><span style=color:#a6e22e>getBand</span><span style=color:#f92672>(),</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Integer count <span style=color:#f92672>=</span> bandAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>employee<span style=color:#f92672>.</span><span style=color:#a6e22e>getBand</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        count<span style=color:#f92672>++;</span>
</span></span><span style=display:flex><span>        bandAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>employee<span style=color:#f92672>.</span><span style=color:#a6e22e>getBand</span><span style=color:#f92672>(),</span> count<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>We have some common values, and might be able to save some lines if we find that common things and refactor it properly, lets go with that…</p><hr><p>This time, lets use stream.collect() method everywhere. So we have changes only on 2 method calls findMostRepeatingNameInCompany and findMostPopularBandInCompany</p><h3 id=find-out-the-most-common-employee-name-in-the-company-2>Find out the most common employee name in the company</h3><p>Let’s try to use collect here, and avoid addToNameAndCountMap method call, If we use the right collector, we can collect data to a map, with a custom key or value. We are going to use <code>Collectors.groupingBy(Employee::getName,Collectors.counting())</code> for this.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>findMostRepeatingNameInCompany</span><span style=color:#f92672>(</span>Company company<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> Long<span style=color:#f92672>&gt;</span> nameAndCount <span style=color:#f92672>=</span> company<span style=color:#f92672>.</span><span style=color:#a6e22e>getDepartments</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>flatMap</span><span style=color:#f92672>(</span>department <span style=color:#f92672>-&gt;</span> department<span style=color:#f92672>.</span><span style=color:#a6e22e>getEmployees</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>())</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>collect</span><span style=color:#f92672>(</span>Collectors<span style=color:#f92672>.</span><span style=color:#a6e22e>groupingBy</span><span style=color:#f92672>(</span>Employee<span style=color:#f92672>::</span>getName<span style=color:#f92672>,</span>Collectors<span style=color:#f92672>.</span><span style=color:#a6e22e>counting</span><span style=color:#f92672>()));</span>
</span></span><span style=display:flex><span>    Long maxCount <span style=color:#f92672>=</span> Collections<span style=color:#f92672>.</span><span style=color:#a6e22e>max</span><span style=color:#f92672>(</span>nameAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>values</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    Optional<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> repeat <span style=color:#f92672>=</span> nameAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>entrySet</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>filter</span><span style=color:#f92672>(</span>e <span style=color:#f92672>-&gt;</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getValue</span><span style=color:#f92672>().</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>maxCount<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>map</span><span style=color:#f92672>(</span>Map<span style=color:#f92672>.</span><span style=color:#a6e22e>Entry</span><span style=color:#f92672>::</span>getKey<span style=color:#f92672>).</span><span style=color:#a6e22e>findFirst</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    String repeatingName <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>repeat<span style=color:#f92672>.</span><span style=color:#a6e22e>isPresent</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        repeatingName <span style=color:#f92672>=</span> repeat<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> repeatingName<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=find-most-popular-gradeband-in-the-company-2>Find most popular grade/band in the company</h3><p>Let’s do the same thing here as well,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> Band <span style=color:#a6e22e>findMostPopularBandInCompany</span><span style=color:#f92672>(</span>Company company<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    Map<span style=color:#f92672>&lt;</span>Band<span style=color:#f92672>,</span> Long<span style=color:#f92672>&gt;</span> bandAndCount <span style=color:#f92672>=</span> company<span style=color:#f92672>.</span><span style=color:#a6e22e>getDepartments</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>flatMap</span><span style=color:#f92672>(</span>department <span style=color:#f92672>-&gt;</span> department<span style=color:#f92672>.</span><span style=color:#a6e22e>getEmployees</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>())</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>collect</span><span style=color:#f92672>(</span>Collectors<span style=color:#f92672>.</span><span style=color:#a6e22e>groupingBy</span><span style=color:#f92672>(</span>Employee<span style=color:#f92672>::</span>getBand<span style=color:#f92672>,</span> Collectors<span style=color:#f92672>.</span><span style=color:#a6e22e>counting</span><span style=color:#f92672>()));</span>
</span></span><span style=display:flex><span>    Band popularBand <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    Long maxBand <span style=color:#f92672>=</span> Collections<span style=color:#f92672>.</span><span style=color:#a6e22e>max</span><span style=color:#f92672>(</span>bandAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>values</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    Optional<span style=color:#f92672>&lt;</span>Band<span style=color:#f92672>&gt;</span> popular <span style=color:#f92672>=</span> bandAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>entrySet</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>filter</span><span style=color:#f92672>(</span>e <span style=color:#f92672>-&gt;</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getValue</span><span style=color:#f92672>().</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>maxBand<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>map</span><span style=color:#f92672>(</span>Map<span style=color:#f92672>.</span><span style=color:#a6e22e>Entry</span><span style=color:#f92672>::</span>getKey<span style=color:#f92672>).</span><span style=color:#a6e22e>findFirst</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>popular<span style=color:#f92672>.</span><span style=color:#a6e22e>isPresent</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        popularBand <span style=color:#f92672>=</span> popular<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> popularBand<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Now we have a common pattern, and it seems there are possibilities to extract some functional components out of it. Let’s explore that possibility.</p><hr><p>We could see that the methods findMostRepeatingNameInCompany, findEmployeeWithHighestSalaryInTheCompany & findMostPopularBandInCompany follows a similar pattern. Only difference is the type of map, and the collector we use. So, lets write a method that returns a generic map, and accept a collector.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> Map<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>,</span> Long<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>processEmployeeToMap</span><span style=color:#f92672>(</span>Company company<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                                                     Collector<span style=color:#f92672>&lt;</span>Employee<span style=color:#f92672>,</span> <span style=color:#f92672>?,</span> Map<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>,</span>Long<span style=color:#f92672>&gt;&gt;</span>
</span></span><span style=display:flex><span>                                                     employeeMapCollector<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> company<span style=color:#f92672>.</span><span style=color:#a6e22e>getDepartments</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>flatMap</span><span style=color:#f92672>(</span>department <span style=color:#f92672>-&gt;</span> department<span style=color:#f92672>.</span><span style=color:#a6e22e>getEmployees</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>())</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>collect</span><span style=color:#f92672>(</span>employeeMapCollector<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>This is a generic method, it works for different inputs, if T is string, it will use the collector to get a Map&lt;String, Long> as return. If we use another object, say Employee, then the return type will be Map&lt;Employee, Long>. Let’s try using this method call in these 3 methods.</p><h3 id=find-out-the-most-common-employee-name-in-the-company-3>Find out the most common employee name in the company</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>findMostRepeatingNameInCompany</span><span style=color:#f92672>(</span>Company company<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    Collector<span style=color:#f92672>&lt;</span>Employee<span style=color:#f92672>,</span> <span style=color:#f92672>?,</span> Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> Long<span style=color:#f92672>&gt;&gt;</span> repeatingNameCollector <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>            Collectors<span style=color:#f92672>.</span><span style=color:#a6e22e>groupingBy</span><span style=color:#f92672>(</span>Employee<span style=color:#f92672>::</span>getName<span style=color:#f92672>,</span>Collectors<span style=color:#f92672>.</span><span style=color:#a6e22e>counting</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> Long<span style=color:#f92672>&gt;</span> nameAndCount <span style=color:#f92672>=</span> processEmployeeToMap<span style=color:#f92672>(</span>company<span style=color:#f92672>,</span>repeatingNameCollector<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    Long maxCount <span style=color:#f92672>=</span> Collections<span style=color:#f92672>.</span><span style=color:#a6e22e>max</span><span style=color:#f92672>(</span>nameAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>values</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    Optional<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> repeat <span style=color:#f92672>=</span> nameAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>entrySet</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>filter</span><span style=color:#f92672>(</span>e <span style=color:#f92672>-&gt;</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getValue</span><span style=color:#f92672>().</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>maxCount<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>map</span><span style=color:#f92672>(</span>Map<span style=color:#f92672>.</span><span style=color:#a6e22e>Entry</span><span style=color:#f92672>::</span>getKey<span style=color:#f92672>).</span><span style=color:#a6e22e>findFirst</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    String repeatingName <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>repeat<span style=color:#f92672>.</span><span style=color:#a6e22e>isPresent</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        repeatingName <span style=color:#f92672>=</span> repeat<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> repeatingName<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=find-the-highest-salaried-employee-2>Find the highest salaried employee</h3><p>Let’s do the same refactoring here as well,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> Employee <span style=color:#a6e22e>findEmployeeWithHighestSalaryInTheCompany</span><span style=color:#f92672>(</span>Company company<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    Collector<span style=color:#f92672>&lt;</span>Employee<span style=color:#f92672>,?,</span>Map<span style=color:#f92672>&lt;</span>Employee<span style=color:#f92672>,</span>Long<span style=color:#f92672>&gt;&gt;</span> highSalary <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>            Collectors<span style=color:#f92672>.</span><span style=color:#a6e22e>toMap</span><span style=color:#f92672>(</span>employee <span style=color:#f92672>-&gt;</span> employee<span style=color:#f92672>,</span> Employee<span style=color:#f92672>::</span>getSalary<span style=color:#f92672>,</span> <span style=color:#f92672>(</span>a<span style=color:#f92672>,</span> b<span style=color:#f92672>)</span> <span style=color:#f92672>-&gt;</span> b<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    Map<span style=color:#f92672>&lt;</span>Employee<span style=color:#f92672>,</span> Long<span style=color:#f92672>&gt;</span> employeeAndSalary <span style=color:#f92672>=</span> processEmployeeToMap<span style=color:#f92672>(</span>company<span style=color:#f92672>,</span>highSalary<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    Long maxSalary <span style=color:#f92672>=</span> Collections<span style=color:#f92672>.</span><span style=color:#a6e22e>max</span><span style=color:#f92672>(</span>employeeAndSalary<span style=color:#f92672>.</span><span style=color:#a6e22e>values</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    Optional<span style=color:#f92672>&lt;</span>Employee<span style=color:#f92672>&gt;</span> costly <span style=color:#f92672>=</span> employeeAndSalary<span style=color:#f92672>.</span><span style=color:#a6e22e>entrySet</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>filter</span><span style=color:#f92672>(</span>e <span style=color:#f92672>-&gt;</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getValue</span><span style=color:#f92672>().</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>maxSalary<span style=color:#f92672>)).</span><span style=color:#a6e22e>map</span><span style=color:#f92672>(</span>Map<span style=color:#f92672>.</span><span style=color:#a6e22e>Entry</span><span style=color:#f92672>::</span>getKey<span style=color:#f92672>).</span><span style=color:#a6e22e>findFirst</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    Employee costlyEmployee <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>costly<span style=color:#f92672>.</span><span style=color:#a6e22e>isPresent</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        costlyEmployee <span style=color:#f92672>=</span> costly<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> costlyEmployee<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=find-most-popular-gradeband-in-the-company-3>Find most popular grade/band in the company</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> Band <span style=color:#a6e22e>findMostPopularBandInCompany</span><span style=color:#f92672>(</span>Company company<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    Collector<span style=color:#f92672>&lt;</span>Employee<span style=color:#f92672>,?,</span>Map<span style=color:#f92672>&lt;</span>Band<span style=color:#f92672>,</span>Long<span style=color:#f92672>&gt;&gt;</span> popularBandCollector <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>            Collectors<span style=color:#f92672>.</span><span style=color:#a6e22e>groupingBy</span><span style=color:#f92672>(</span>Employee<span style=color:#f92672>::</span>getBand<span style=color:#f92672>,</span> Collectors<span style=color:#f92672>.</span><span style=color:#a6e22e>counting</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    Map<span style=color:#f92672>&lt;</span>Band<span style=color:#f92672>,</span> Long<span style=color:#f92672>&gt;</span> bandAndCount <span style=color:#f92672>=</span> processEmployeeToMap<span style=color:#f92672>(</span>company<span style=color:#f92672>,</span>popularBandCollector<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    Band popularBand <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    Long maxBand <span style=color:#f92672>=</span> Collections<span style=color:#f92672>.</span><span style=color:#a6e22e>max</span><span style=color:#f92672>(</span>bandAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>values</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    Optional<span style=color:#f92672>&lt;</span>Band<span style=color:#f92672>&gt;</span> popular <span style=color:#f92672>=</span> bandAndCount<span style=color:#f92672>.</span><span style=color:#a6e22e>entrySet</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>filter</span><span style=color:#f92672>(</span>e <span style=color:#f92672>-&gt;</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getValue</span><span style=color:#f92672>().</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>maxBand<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>map</span><span style=color:#f92672>(</span>Map<span style=color:#f92672>.</span><span style=color:#a6e22e>Entry</span><span style=color:#f92672>::</span>getKey<span style=color:#f92672>).</span><span style=color:#a6e22e>findFirst</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>popular<span style=color:#f92672>.</span><span style=color:#a6e22e>isPresent</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        popularBand <span style=color:#f92672>=</span> popular<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> popularBand<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=find-the-sum-of-salaries-for-all-men-2>Find the sum of salaries for all Men</h3><p>Well, we need a different way here, as this one is completely different from the rest of the methods,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> Function<span style=color:#f92672>&lt;</span>Department<span style=color:#f92672>,</span> Stream<span style=color:#f92672>&lt;</span>Employee<span style=color:#f92672>&gt;&gt;</span> 
</span></span><span style=display:flex><span>          allEmployeeInDept <span style=color:#f92672>=</span> department <span style=color:#f92672>-&gt;</span> department<span style=color:#f92672>.</span><span style=color:#a6e22e>getEmployees</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> Long <span style=color:#a6e22e>findSumOfAllMenSalary</span><span style=color:#f92672>(</span>Company company<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> company<span style=color:#f92672>.</span><span style=color:#a6e22e>getDepartments</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>flatMap</span><span style=color:#f92672>(</span>d <span style=color:#f92672>-&gt;</span> allEmployeeInDept<span style=color:#f92672>.</span><span style=color:#a6e22e>apply</span><span style=color:#f92672>(</span>d<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>filter</span><span style=color:#f92672>(</span>e <span style=color:#f92672>-&gt;</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getGender</span><span style=color:#f92672>().</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>Gender<span style=color:#f92672>.</span><span style=color:#a6e22e>MALE</span><span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>map</span><span style=color:#f92672>(</span>Employee<span style=color:#f92672>::</span>getSalary<span style=color:#f92672>).</span><span style=color:#a6e22e>mapToLong</span><span style=color:#f92672>(</span>Long<span style=color:#f92672>::</span>longValue<span style=color:#f92672>).</span><span style=color:#a6e22e>sum</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Well, we have used the functional components, and achieved a better reusable code, but still this can be cleaned up a bit.</p><hr><p>You might have noticed that all these methods need a single value in return, not a list. And, we use optional and some logic to identify that single element. Can we extract that too, let’s try that now.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> T <span style=color:#a6e22e>fetchParamsFromMap</span><span style=color:#f92672>(</span>Map<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>,</span> Long<span style=color:#f92672>&gt;</span> param<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> param<span style=color:#f92672>.</span><span style=color:#a6e22e>entrySet</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>filter</span><span style=color:#f92672>(</span>e <span style=color:#f92672>-&gt;</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getValue</span><span style=color:#f92672>().</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>Collections<span style=color:#f92672>.</span><span style=color:#a6e22e>max</span><span style=color:#f92672>(</span>param<span style=color:#f92672>.</span><span style=color:#a6e22e>values</span><span style=color:#f92672>())))</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>map</span><span style=color:#f92672>(</span>Map<span style=color:#f92672>.</span><span style=color:#a6e22e>Entry</span><span style=color:#f92672>::</span>getKey<span style=color:#f92672>).</span><span style=color:#a6e22e>findFirst</span><span style=color:#f92672>().</span><span style=color:#a6e22e>orElse</span><span style=color:#f92672>(</span><span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>This method returns the key of biggest param in a map, using generics, this one can be applied to all of our methods</p><h3 id=find-out-the-most-common-employee-name-in-the-company-4>Find out the most common employee name in the company</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>findMostRepeatingNameInCompany</span><span style=color:#f92672>(</span>Company company<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    Collector<span style=color:#f92672>&lt;</span>Employee<span style=color:#f92672>,</span> <span style=color:#f92672>?,</span> Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> Long<span style=color:#f92672>&gt;&gt;</span> repeatingNameCollector <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>            Collectors<span style=color:#f92672>.</span><span style=color:#a6e22e>groupingBy</span><span style=color:#f92672>(</span>Employee<span style=color:#f92672>::</span>getName<span style=color:#f92672>,</span> Collectors<span style=color:#f92672>.</span><span style=color:#a6e22e>counting</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> Long<span style=color:#f92672>&gt;</span> nameAndCount <span style=color:#f92672>=</span> processEmployeeToMap<span style=color:#f92672>(</span>company<span style=color:#f92672>,</span> repeatingNameCollector<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> fetchParamsFromMap<span style=color:#f92672>(</span>nameAndCount<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>that simple ? yes, it is</p><h3 id=find-the-highest-salaried-employee-3>Find the highest salaried employee</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> Employee <span style=color:#a6e22e>findEmployeeWithHighestSalaryInTheCompany</span><span style=color:#f92672>(</span>Company company<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    Collector<span style=color:#f92672>&lt;</span>Employee<span style=color:#f92672>,</span> <span style=color:#f92672>?,</span> Map<span style=color:#f92672>&lt;</span>Employee<span style=color:#f92672>,</span> Long<span style=color:#f92672>&gt;&gt;</span> highSalary <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>            Collectors<span style=color:#f92672>.</span><span style=color:#a6e22e>toMap</span><span style=color:#f92672>(</span>employee <span style=color:#f92672>-&gt;</span> employee<span style=color:#f92672>,</span> Employee<span style=color:#f92672>::</span>getSalary<span style=color:#f92672>,</span> <span style=color:#f92672>(</span>a<span style=color:#f92672>,</span> b<span style=color:#f92672>)</span> <span style=color:#f92672>-&gt;</span> b<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    Map<span style=color:#f92672>&lt;</span>Employee<span style=color:#f92672>,</span> Long<span style=color:#f92672>&gt;</span> employeeAndSalary <span style=color:#f92672>=</span> processEmployeeToMap<span style=color:#f92672>(</span>company<span style=color:#f92672>,</span> highSalary<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> fetchParamsFromMap<span style=color:#f92672>(</span>employeeAndSalary<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=find-most-popular-gradeband-in-the-company-4>Find most popular grade/band in the company</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> Band <span style=color:#a6e22e>findMostPopularBandInCompany</span><span style=color:#f92672>(</span>Company company<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    Collector<span style=color:#f92672>&lt;</span>Employee<span style=color:#f92672>,</span> <span style=color:#f92672>?,</span> Map<span style=color:#f92672>&lt;</span>Band<span style=color:#f92672>,</span> Long<span style=color:#f92672>&gt;&gt;</span> popularBandCollector <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>            Collectors<span style=color:#f92672>.</span><span style=color:#a6e22e>groupingBy</span><span style=color:#f92672>(</span>Employee<span style=color:#f92672>::</span>getBand<span style=color:#f92672>,</span> Collectors<span style=color:#f92672>.</span><span style=color:#a6e22e>counting</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    Map<span style=color:#f92672>&lt;</span>Band<span style=color:#f92672>,</span> Long<span style=color:#f92672>&gt;</span> bandAndCount <span style=color:#f92672>=</span> processEmployeeToMap<span style=color:#f92672>(</span>company<span style=color:#f92672>,</span> popularBandCollector<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> fetchParamsFromMap<span style=color:#f92672>(</span>bandAndCount<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Done ? No, we are not done yet… there is a bit more to do.</p><hr><p>In the methods <code>findMostRepeatingNameInCompany</code>, <code>findEmployeeWithHighestSalaryInTheCompany</code> & <code>findMostPopularBandInCompany</code> there is still a repeating pattern, we use <code>processEmployeeToMap</code> and immediately we call <code>fetchParamsFromMap</code>. Let’s combine it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> T <span style=color:#a6e22e>fetchBestOfMappedEmployees</span><span style=color:#f92672>(</span>Company company<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                                                Collector<span style=color:#f92672>&lt;</span>Employee<span style=color:#f92672>,</span> <span style=color:#f92672>?,</span> Map<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>,</span> Long<span style=color:#f92672>&gt;&gt;</span> employeeMapCollector<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    Map<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>,</span> Long<span style=color:#f92672>&gt;</span> mappedResults <span style=color:#f92672>=</span> company<span style=color:#f92672>.</span><span style=color:#a6e22e>getDepartments</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>flatMap</span><span style=color:#f92672>(</span>department <span style=color:#f92672>-&gt;</span> department<span style=color:#f92672>.</span><span style=color:#a6e22e>getEmployees</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>())</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>collect</span><span style=color:#f92672>(</span>employeeMapCollector<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> mappedResults<span style=color:#f92672>.</span><span style=color:#a6e22e>entrySet</span><span style=color:#f92672>().</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>filter</span><span style=color:#f92672>(</span>e <span style=color:#f92672>-&gt;</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getValue</span><span style=color:#f92672>().</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>Collections<span style=color:#f92672>.</span><span style=color:#a6e22e>max</span><span style=color:#f92672>(</span>mappedResults<span style=color:#f92672>.</span><span style=color:#a6e22e>values</span><span style=color:#f92672>())))</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>map</span><span style=color:#f92672>(</span>Map<span style=color:#f92672>.</span><span style=color:#a6e22e>Entry</span><span style=color:#f92672>::</span>getKey<span style=color:#f92672>).</span><span style=color:#a6e22e>findFirst</span><span style=color:#f92672>().</span><span style=color:#a6e22e>orElse</span><span style=color:#f92672>(</span><span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Now, let’s see how our methods looks like,</p><h3 id=find-out-the-most-common-employee-name-in-the-company-5>Find out the most common employee name in the company</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>findMostRepeatingNameInCompany</span><span style=color:#f92672>(</span>Company company<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    Collector<span style=color:#f92672>&lt;</span>Employee<span style=color:#f92672>,</span> <span style=color:#f92672>?,</span> Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> Long<span style=color:#f92672>&gt;&gt;</span> repeatingNameCollector <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>            Collectors<span style=color:#f92672>.</span><span style=color:#a6e22e>groupingBy</span><span style=color:#f92672>(</span>Employee<span style=color:#f92672>::</span>getName<span style=color:#f92672>,</span> Collectors<span style=color:#f92672>.</span><span style=color:#a6e22e>counting</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> fetchBestOfMappedEmployees<span style=color:#f92672>(</span>company<span style=color:#f92672>,</span> repeatingNameCollector<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=find-the-highest-salaried-employee-4>Find the highest salaried employee</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> Employee <span style=color:#a6e22e>findEmployeeWithHighestSalaryInTheCompany</span><span style=color:#f92672>(</span>Company company<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    Collector<span style=color:#f92672>&lt;</span>Employee<span style=color:#f92672>,</span> <span style=color:#f92672>?,</span> Map<span style=color:#f92672>&lt;</span>Employee<span style=color:#f92672>,</span> Long<span style=color:#f92672>&gt;&gt;</span> highSalary <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>            Collectors<span style=color:#f92672>.</span><span style=color:#a6e22e>toMap</span><span style=color:#f92672>(</span>employee <span style=color:#f92672>-&gt;</span> employee<span style=color:#f92672>,</span> Employee<span style=color:#f92672>::</span>getSalary<span style=color:#f92672>,</span> <span style=color:#f92672>(</span>a<span style=color:#f92672>,</span> b<span style=color:#f92672>)</span> <span style=color:#f92672>-&gt;</span> b<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> fetchBestOfMappedEmployees<span style=color:#f92672>(</span>company<span style=color:#f92672>,</span> highSalary<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=find-most-popular-gradeband-in-the-company-5>Find most popular grade/band in the company</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> Band <span style=color:#a6e22e>findMostPopularBandInCompany</span><span style=color:#f92672>(</span>Company company<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    Collector<span style=color:#f92672>&lt;</span>Employee<span style=color:#f92672>,</span> <span style=color:#f92672>?,</span> Map<span style=color:#f92672>&lt;</span>Band<span style=color:#f92672>,</span> Long<span style=color:#f92672>&gt;&gt;</span> popularBandCollector <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>            Collectors<span style=color:#f92672>.</span><span style=color:#a6e22e>groupingBy</span><span style=color:#f92672>(</span>Employee<span style=color:#f92672>::</span>getBand<span style=color:#f92672>,</span> Collectors<span style=color:#f92672>.</span><span style=color:#a6e22e>counting</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> fetchBestOfMappedEmployees<span style=color:#f92672>(</span>company<span style=color:#f92672>,</span> popularBandCollector<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>We can even continue to simplify this, we can put the collectors outside and the parent calls can pass the collect and then we don’t really need this method calls itself.</p><p>All code is available on github, and each separate iteration is in separate commit, please check this out at <a href=https://github.com/surajcm/java_fun_extraction_01/commits/master>https://github.com/surajcm/java_fun_extraction_01/commits/master</a></p><ul class=pa0></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://surajcm.github.io/blog/>&copy; Explore my world 2023</a><div><div class=ananke-socials></div></div></div></footer></body></html>